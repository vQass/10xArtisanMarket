name: CI

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  test:
    name: Run Unit Tests
    runs-on: ubuntu-latest

    env:
      DOTNET_CLI_TELEMETRY_OPTOUT: 1
      DOTNET_SKIP_FIRST_TIME_EXPERIENCE: 1

    steps:
    - name: Checkout code
      uses: actions/checkout@v6

    - name: Setup .NET
      uses: ./.github/actions/setup-dotnet
      with:
        dotnet-version: '9.0.x'

    - name: Run tests
      uses: ./.github/actions/run-tests
      with:
        test-project-path: 'ArtisanMarket.Tests'

  build:
    name: Build Application
    runs-on: ubuntu-latest
    needs: test

    env:
      DOTNET_CLI_TELEMETRY_OPTOUT: 1
      DOTNET_SKIP_FIRST_TIME_EXPERIENCE: 1

    steps:
    - name: Checkout code
      uses: actions/checkout@v6

    - name: Setup .NET
      uses: ./.github/actions/setup-dotnet
      with:
        dotnet-version: '9.0.x'

    - name: Build application
      uses: ./.github/actions/build-app
      with:
        project-path: 'ArtisanMarket.BlazorApp'
        configuration: 'Release'
